<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot UFSM - Reconhecimento de Diploma</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #005386 0%, #003151 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .chatbot-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            width: 100%;
            overflow: hidden;
            position: relative;
        }

        .header {
            background: linear-gradient(135deg, #005386 0%, #003151 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .logo {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }

        .graduation-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .progress-bar {
            height: 6px;
            background: #e0e0e0;
            margin: 0 30px;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #005386, #0066a3);
            width: 0%;
            transition: width 0.5s ease;
        }

        .chat-area {
            padding: 30px;
            max-height: 600px;
            overflow-y: auto;
        }

        .message {
            display: flex;
            margin-bottom: 20px;
            animation: slideIn 0.5s ease;
        }

        .message.hidden {
            display: none;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #005386, #0066a3);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .message-content {
            background: #f8f9fa;
            padding: 15px 20px;
            border-radius: 15px;
            border-top-left-radius: 5px;
            max-width: 85%;
            line-height: 1.6;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .typing-indicator {
            display: none;
            padding: 15px 20px;
            background: #f8f9fa;
            border-radius: 15px;
            border-top-left-radius: 5px;
            margin-left: 55px;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dots span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #005386;
            animation: typing 1.4s infinite;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.4;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
        }

        .btn-info {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
        }

        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(23, 162, 184, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107, #e0a800);
            color: #212529;
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 193, 7, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        .search-container {
            margin: 15px 0;
        }

        .search-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #005386;
        }

        .institution-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            margin-top: 10px;
        }

        .institution-item {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background-color 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .institution-item:hover {
            background-color: #f8f9fa;
        }

        .institution-item.selected {
            background-color: #e3f2fd;
            border-left: 4px solid #005386;
        }

        .institution-item:last-child {
            border-bottom: none;
        }

        .institution-info {
            flex-grow: 1;
        }

        .institution-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .institution-country {
            color: #666;
            font-size: 14px;
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-deferida {
            background: #d4edda;
            color: #155724;
        }

        .status-indeferida {
            background: #f8d7da;
            color: #721c24;
        }

        .status-cancelada {
            background: #fff3cd;
            color: #856404;
        }

        .document-list {
            margin: 20px 0;
        }

        .document-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #005386;
            transition: all 0.3s ease;
        }

        .document-item:hover {
            background: #e9ecef;
        }

        .document-checkbox {
            margin-right: 12px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .document-text {
            flex-grow: 1;
            font-size: 14px;
            line-height: 1.4;
        }

        .document-counter {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 10px;
            font-weight: 600;
            color: #005386;
        }

        .warning-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            display: flex;
            align-items: center;
        }

        .warning-icon {
            color: #856404;
            font-size: 24px;
            margin-right: 10px;
        }

        .warning-text {
            color: #856404;
            font-size: 14px;
        }

        .info-box {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            display: flex;
            align-items: center;
        }

        .info-icon {
            color: #0c5460;
            font-size: 24px;
            margin-right: 10px;
        }

        .info-text {
            color: #0c5460;
            font-size: 14px;
        }

        .error-message {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .error-icon {
            color: #721c24;
            font-size: 48px;
            margin-bottom: 10px;
        }

        .error-title {
            color: #721c24;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .error-text {
            color: #721c24;
            margin-bottom: 15px;
        }

        .success-message {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .success-icon {
            color: #155724;
            font-size: 48px;
            margin-bottom: 10px;
        }

        .success-title {
            color: #155724;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .success-text {
            color: #155724;
            margin-bottom: 15px;
        }

        .link-button {
            display: inline-block;
            margin: 5px;
            padding: 10px 20px;
            background: #005386;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            transition: background 0.3s ease;
        }

        .link-button:hover {
            background: #003151;
        }

        .not-found-button {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            margin-top: 15px;
            width: 100%;
        }

        .not-found-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 117, 125, 0.4);
        }

        @media (max-width: 768px) {
            .chatbot-container {
                margin: 10px;
                border-radius: 15px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .chat-area {
                padding: 20px;
            }

            .message-content {
                max-width: 90%;
            }

            .btn {
                padding: 10px 20px;
                font-size: 13px;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="chatbot-container">
        <div class="header">
            <div class="logo">UFSM</div>
            <div class="graduation-icon">üéì</div>
            <h1>Assistente UFSM</h1>
            <p>Reconhecimento de Diploma</p>
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>

        <div class="chat-area" id="chatArea">
            <!-- Step 0: Initial Welcome -->
            <div class="message" id="step0">
                <div class="avatar">ü§ñ</div>
                <div class="message-content">
                    Ol√°! Sou seu assistente virtual para o processo de reconhecimento de diploma na UFSM. Vou te guiar atrav√©s de todas as etapas necess√°rias.
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="startChat()">Iniciar Consulta</button>
                    </div>
                </div>
            </div>

            <!-- Step 1: Equivalent Course -->
            <div class="message hidden" id="step1">
                <div class="avatar">ü§ñ</div>
                <div class="message-content">
                    Perfeito! Agora preciso saber: existe um curso equivalente na UFSM para o seu diploma?
                    <div class="info-box">
                        <span class="info-icon">üìã</span>
                        <span class="info-text">A lista de cursos oferecidos pela UFSM est√° dispon√≠vel no edital na Tabela 1. Consulte o documento para verificar se existe um curso equivalente ao seu.</span>
                    </div>
                    <div class="button-group">
                        <a href="https://portal.ufsm.br/documentos/download.html;jsessionid=37d2108325e9aa84f1b44c353aa0?action=arquivosIndexados&id=15347047&download=false" target="_blank" class="btn btn-info">Consultar Edital UFSM</a>
                    </div>
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="handleEquivalentCourse('yes')">Sim</button>
                        <button class="btn btn-secondary" onclick="handleEquivalentCourse('no')">N√£o</button>
                    </div>
                </div>
            </div>

            <!-- Step 2: Presential Course -->
            <div class="message hidden" id="step2">
                <div class="avatar">ü§ñ</div>
                <div class="message-content">
                    √ìtimo! O seu curso foi realizado de forma presencial? Cursos em regime semi-presencial, √† dist√¢ncia, modular, de forma sazonal ou intensivo n√£o s√£o reconhecidos pela UFSM.
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="handlePresentialCourse('yes')">Sim</button>
                        <button class="btn btn-secondary" onclick="handlePresentialCourse('no')">N√£o</button>
                    </div>
                </div>
            </div>

            <!-- Step 3: Institution Search -->
            <div class="message hidden" id="step3">
                <div class="avatar">ü§ñ</div>
                <div class="message-content">
                    Excelente! Agora voc√™ pode consultar nossa base de dados para verificar se sua institui√ß√£o e curso j√° tiveram processos de reconhecimento anteriores. Selecione uma institui√ß√£o da lista abaixo:
                    <div class="search-container">
                        <input type="text" id="institutionSearch" class="search-input" placeholder="Buscar institui√ß√£o..." oninput="loadInstitutions()">
                    </div>
                    <div class="institution-list" id="institutionList">
                        <!-- Institutions will be loaded here by JavaScript -->
                    </div>
                    <div class="button-group">
                        <button class="btn btn-primary" id="selectInstitutionBtn" onclick="handleInstitutionSelection()" disabled>Prosseguir com Sele√ß√£o</button>
                        <button class="btn not-found-button" onclick="handleInstitutionNotFound()">Minha institui√ß√£o n√£o est√° aqui</button>
                    </div>
                </div>
            </div>

            <!-- Step 4: Document Checklist -->
            <div class="message hidden" id="step4">
                <div class="avatar">ü§ñ</div>
                <div class="message-content">
                    Agora vamos verificar sua documenta√ß√£o. Marque os documentos que voc√™ j√° possui:
                    <div class="info-box">
                        <span class="info-icon">‚ÑπÔ∏è</span>
                        <span class="info-text">Todos os documentos s√£o importantes, mas voc√™ pode prosseguir mesmo que n√£o tenha todos ainda. Esta √© apenas uma verifica√ß√£o para te orientar.</span>
                    </div>
                    <div class="document-list" id="documentList">
                        <!-- Documents will be loaded here by JavaScript -->
                    </div>
                    <div class="document-counter" id="documentCounter">0 de 16 documentos marcados</div>
                    <div class="button-group">
                        <button class="btn btn-primary" id="continueDocumentsBtn" onclick="handleDocumentCheck()">Continuar</button>
                    </div>
                </div>
            </div>

                    <!-- Step 5: Apostille -->
            <div class="message hidden" id="step5">
                <div class="avatar">ü§ñ</div>
                <div class="message-content">
                    √ìtimo! Lembramos que para sua solicita√ß√£o ser analisada √© necess√°rio possuir todos os documentos obrigat√≥rios. Agora preciso saber: seus documentos est√£o apostilados conforme a Conven√ß√£o de Haia?
                    <div class="warning-box">
                        <span class="warning-icon">‚ö†Ô∏è</span>
                        <span class="warning-text">Aten√ß√£o: Os documentos que OBRIGATORIAMENTE precisam estar apostilados s√£o: ATA de defesa, Hist√≥rico Escolar e Diploma.</span>
                    </div>
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="handleApostille('yes')">Sim</button>
                        <button class="btn btn-secondary" onclick="handleApostille('no')">N√£o</button>
                    </div>
                </div>
            </div>>

            <!-- Final Messages -->
            <div class="message hidden" id="finalSuccess">
                <div class="avatar">üéâ</div>
                <div class="message-content success-message">
                    <div class="success-icon">‚úÖ</div>
                    <div class="success-title">Parab√©ns! Voc√™ est√° pronto para iniciar seu processo!</div>
                    <div class="success-text">
                        Com base nas suas respostas, voc√™ atende aos requisitos iniciais para o reconhecimento de diploma na UFSM.
                        Voc√™ pode iniciar seu processo na Plataforma Carolina Bori e consultar os editais para mais informa√ß√µes.
                    </div>
                    <a href="https://carolinabori.mec.gov.br/" target="_blank" class="link-button">Acessar Plataforma Carolina Bori</a>
                    <a href="https://www.ufsm.br/pro-reitorias/prpgp/reconhecimento-de-diplomas" target="_blank" class="link-button">Acessar Editais UFSM</a>
                    <div class="button-group">
                        <button class="btn btn-info" onclick="restartChat()">Nova Consulta</button>
                    </div>
                </div>
            </div>

                      <div class="message hidden" id="finalNoEquivalentCourse">
                <div class="avatar">‚ùå</div>
                <div class="message-content error-message">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-title">N√£o √© poss√≠vel prosseguir no momento.</div>
                    <div class="error-text">
                        Para o reconhecimento de diploma na UFSM, √© necess√°rio que exista um curso equivalente em nossa institui√ß√£o. Recomendamos que voc√™ verifique outras Institui√ß√µes que possuem curso equivalente ao que voc√™ realizou no exterior para prosseguir com a solicita√ß√£o.
                    </div>
                    <div class="button-group">
                        <button class="btn btn-info" onclick="restartChat()">Nova Consulta</button>
                    </div>
                </div>
            </div>        </div>

            <div class="message hidden" id="finalNoPresentialCourse">
                <div class="avatar">‚ùå</div>
                <div class="message-content error-message">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-title">N√£o √© poss√≠vel prosseguir no momento.</div>
                    <div class="error-text">
                        O reconhecimento de diploma na UFSM √© aplic√°vel apenas a cursos realizados de forma presencial.
                        Diplomas de cursos a dist√¢ncia ou semipresenciais n√£o s√£o eleg√≠veis para este processo.
                    </div>
                    <div class="button-group">
                        <button class="btn btn-info" onclick="restartChat()">Nova Consulta</button>
                    </div>
                </div>
            </div>

            <div class="message hidden" id="finalNoApostille">
                <div class="avatar">‚ö†Ô∏è</div>
                <div class="message-content error-message">
                    <div class="error-icon">‚ö†Ô∏è</div>
                    <div class="error-title">Documentos n√£o apostilados</div>
                    <div class="error-text">
                        Para prosseguir com o reconhecimento de diploma, seus documentos (ATA, Hist√≥rico e Diploma) devem estar apostilados conforme a Conven√ß√£o de Haia.
                        Por favor, providencie o apostilamento e tente novamente.
                    </div>
                    <div class="button-group">
                        <button class="btn btn-info" onclick="restartChat()">Nova Consulta</button>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        let currentStep = 0;
        let selectedInstitution = null;

        const institutionData = [
            // Institui√ß√µes Deferidas
            {"name": "Universidad Nacional de La Plata", "country": "Argentina", "status": "DEFERIDA"},
            {"name": "Katholieke Universiteit Leuven", "country": "B√©lgica", "status": "DEFERIDA"},
            {"name": "Universidad de Antioquia", "country": "Col√¥mbia", "status": "DEFERIDA"},
            {"name": "Universidad de Granada", "country": "Espanha", "status": "DEFERIDA"},
            {"name": "Universidad de Leon", "country": "Espanha", "status": "DEFERIDA"},
            {"name": "Universidad de Navarra", "country": "Espanha", "status": "DEFERIDA"},
            {"name": "Universidade de Vigo", "country": "Espanha", "status": "DEFERIDA"},
            {"name": "University of California, Davis", "country": "EUA", "status": "DEFERIDA"},
            {"name": "University of Oklahoma", "country": "EUA", "status": "DEFERIDA"},
            {"name": "Universit√© Grenoble Alpes", "country": "Fran√ßa", "status": "DEFERIDA"},
            {"name": "Wageningen University", "country": "Holanda", "status": "DEFERIDA"},
            {"name": "Universidade de Limerick", "country": "Irlanda", "status": "DEFERIDA"},
            {"name": "University of Otago", "country": "Nova Zel√¢ndia", "status": "DEFERIDA"},
            {"name": "Universidade de Lisboa", "country": "Portugal", "status": "DEFERIDA"},
            {"name": "ISCTE", "country": "Portugal", "status": "DEFERIDA"},
            {"name": "Universidade da Beira Interior", "country": "Portugal", "status": "DEFERIDA"},
            {"name": "Universidade de Aveiro", "country": "Portugal", "status": "DEFERIDA"},
            {"name": "Universidade de √âvora", "country": "Portugal", "status": "DEFERIDA"},
            {"name": "Universidade do Minho", "country": "Portugal", "status": "DEFERIDA"},
            {"name": "Universidad de La Empresa", "country": "Uruguai", "status": "DEFERIDA"},
            
            // Institui√ß√µes Indeferidas
            {"name": "Hochschule Osnabr√ºck", "country": "Alemanha", "status": "INDEFERIDA"},
            {"name": "RWTH Aachen University", "country": "Alemanha", "status": "INDEFERIDA"},
            {"name": "Escola Superior de Economia e Administra√ß√£o de Empresas", "country": "Argentina", "status": "INDEFERIDA"},
            {"name": "Universidad de Ciencias Empresariales Y Sociales", "country": "Argentina", "status": "INDEFERIDA"},
            {"name": "Universidad Nacional de Misiones", "country": "Argentina", "status": "INDEFERIDA"},
            {"name": "Universidad Nacional de Tres de Febrero", "country": "Argentina", "status": "INDEFERIDA"},
            {"name": "Universidad Tecnologica Nacional", "country": "Argentina", "status": "INDEFERIDA"},
            {"name": "Universidade John Kennedy", "country": "Argentina", "status": "INDEFERIDA"},
            {"name": "Universidad Nur", "country": "Canad√°", "status": "INDEFERIDA"},
            {"name": "FUNIBER", "country": "Espanha", "status": "INDEFERIDA"},
            {"name": "Universidad de Ja√©n", "country": "Espanha", "status": "INDEFERIDA"},
            {"name": "Universidad Europea del Atlantico", "country": "Espanha", "status": "INDEFERIDA"},
            {"name": "Universidad Internacional Isabel I", "country": "Espanha", "status": "INDEFERIDA"},
            {"name": "Universidad Pontifica de Salamanca", "country": "Espanha", "status": "INDEFERIDA"},
            {"name": "Universitat Pompeu Fabra", "country": "Espanha", "status": "INDEFERIDA"},
            {"name": "Absolute Christian University", "country": "EUA", "status": "INDEFERIDA"},
            {"name": "Institut D'√âconomie Scientifique et de Gestion", "country": "Fran√ßa", "status": "INDEFERIDA"},
            {"name": "Faculdad Interamericana de Ciencias Sociales", "country": "Paraguai", "status": "INDEFERIDA"},
            {"name": "Universidad Aut√≥noma de Asunci√≥n", "country": "Paraguai", "status": "INDEFERIDA"},
            {"name": "Universidad de La Integracion de Las Americas", "country": "Paraguai", "status": "INDEFERIDA"},
            {"name": "Universidad del Sol", "country": "Paraguai", "status": "INDEFERIDA"},
            {"name": "Universidad Gran Asunci√≥n", "country": "Paraguai", "status": "INDEFERIDA"},
            {"name": "Universidad Interamericana", "country": "Paraguai", "status": "INDEFERIDA"},
            {"name": "Universidad Internacional Tres Fronteras", "country": "Paraguai", "status": "INDEFERIDA"},
            {"name": "Universidad Politecnica Y Artistica del Paraguay", "country": "Paraguai", "status": "INDEFERIDA"},
            {"name": "Universidad Tecnol√≥gica Intercontinental", "country": "Paraguai", "status": "INDEFERIDA"},
            {"name": "Universidade Autonoma de Asunci√≥n", "country": "Paraguai", "status": "INDEFERIDA"},
            {"name": "Universidade Internacional Iberoamericana", "country": "Porto Rico", "status": "INDEFERIDA"},
            {"name": "Instituto Superior de Contabilidade e Administra√ß√£o do Porto", "country": "Portugal", "status": "INDEFERIDA"},
            {"name": "Universidade Catolica Portuguesa", "country": "Portugal", "status": "INDEFERIDA"},
            {"name": "Universidade de Coimbra", "country": "Portugal", "status": "INDEFERIDA"},
            {"name": "Universidade do Porto", "country": "Portugal", "status": "INDEFERIDA"},
            {"name": "Universidade Fernando Pessoa", "country": "Portugal", "status": "INDEFERIDA"},
            {"name": "Universidade Lus√≥fona do Porto", "country": "Portugal", "status": "INDEFERIDA"},
            {"name": "Brunel University London", "country": "Reino Unido", "status": "INDEFERIDA"},
            {"name": "University of Reading", "country": "Reino Unido", "status": "INDEFERIDA"}
        ];

        const documents = [
            { text: "Requerimento espec√≠fico e padr√£o dirigido ao Reitor da UFSM (Anexo 1)" },
            { text: "Cadastro contendo os dados pessoais (Anexo 2)" },
            { text: "Documento de identidade do requerente" },
            { text: "C√≥pia do diploma devidamente registrado (apostilado)" },
            { text: "C√≥pia eletr√¥nica da disserta√ß√£o ou tese, em formato .pdf" },
            { text: "Ata ou documento de defesa oficial da institui√ß√£o de origem (apostilada)" },
            { text: "Nomes dos participantes da banca examinadora e do(a) orientador(a) e respectivos curr√≠culos resumidos" },
            { text: "C√≥pia do hist√≥rico escolar completo (apostilado)" },
            { text: "Descri√ß√£o das atividades de pesquisa realizadas durante o curso" },
            { text: "Curriculum no formato Lattes ou Curriculum vitae" },
            { text: "Avalia√ß√£o externa do curso ou programa de p√≥s-gradua√ß√£o da institui√ß√£o, quando houver" },
            { text: "Licen√ßa de afastamento ou comprova√ß√£o de trabalho remoto, se servidor ou empregado p√∫blico" },
            { text: "Documentos de perman√™ncia no exterior" },
            { text: "Certid√£o de Movimentos Migrat√≥rios (documento expedido pela Pol√≠cia Federal)" },
            { text: "Diploma de gradua√ß√£o" },
            { text: "Declara√ß√£o que n√£o h√° processo de reconhecimento aberto em outra institui√ß√£o (Anexo 3)" }
        ];

        function showStep(stepId) {
            const targetStep = document.getElementById(stepId);
            if (targetStep) {
                targetStep.classList.remove('hidden');
                document.getElementById('chatArea').scrollTop = document.getElementById('chatArea').scrollHeight;
            }
            updateProgressBar();
        }

        function updateProgressBar() {
            const totalSteps = 5;
            const progress = (currentStep / totalSteps) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        function startChat() {
            currentStep = 1;
            showStep('step1');
        }

        function handleEquivalentCourse(response) {
            if (response === 'yes') {
                currentStep = 2;
                showStep('step2');
            } else {
                showStep('finalNoEquivalentCourse');
            }
        }

        function handlePresentialCourse(response) {
            if (response === 'yes') {
                currentStep = 3;
                showStep('step3');
                loadInstitutions();
            } else {
                showStep('finalNoPresentialCourse');
            }
        }

        function loadInstitutions() {
            const institutionListDiv = document.getElementById('institutionList');
            institutionListDiv.innerHTML = '';
            const searchInput = document.getElementById('institutionSearch');
            const searchTerm = searchInput.value.toLowerCase();

            const filteredInstitutions = institutionData.filter(inst => 
                inst.name.toLowerCase().includes(searchTerm) || 
                inst.country.toLowerCase().includes(searchTerm)
            );

            filteredInstitutions.forEach(inst => {
                const item = document.createElement('div');
                item.classList.add('institution-item');
                item.dataset.name = inst.name;
                item.dataset.status = inst.status;
                item.onclick = () => selectInstitution(item);

                let statusClass = '';
                if (inst.status === 'DEFERIDA') {
                    statusClass = 'status-deferida';
                } else if (inst.status === 'INDEFERIDA') {
                    statusClass = 'status-indeferida';
                } else if (inst.status === 'CANCELADA') {
                    statusClass = 'status-cancelada';
                }

                item.innerHTML = `
                    <div class="institution-info">
                        <div class="institution-name">${inst.name}</div>
                        <div class="institution-country">${inst.country}</div>
                    </div>
                    <span class="status-badge ${statusClass}">${inst.status}</span>
                `;
                institutionListDiv.appendChild(item);
            });
        }

        function selectInstitution(item) {
            const allItems = document.querySelectorAll('.institution-item');
            allItems.forEach(i => i.classList.remove('selected'));
            item.classList.add('selected');
            selectedInstitution = { name: item.dataset.name, status: item.dataset.status };
            document.getElementById('selectInstitutionBtn').disabled = false;
        }

        function handleInstitutionSelection() {
            if (selectedInstitution) {
                if (selectedInstitution.status === 'INDEFERIDA') {
                    // Cria a mensagem de aviso dinamicamente no fluxo da conversa
                    const chatArea = document.getElementById('chatArea');
                    const warningMessage = document.createElement('div');
                    warningMessage.classList.add('message');
                    warningMessage.innerHTML = `
                        <div class="avatar">‚ùå</div>
                        <div class="message-content error-message">
                            <div class="error-icon">‚ùå</div>
                            <div class="error-title">Aten√ß√£o: Institui√ß√£o com hist√≥rico de indeferimento</div>
                            <div class="error-text">
                                Infelizmente, a <strong>${selectedInstitution.name}</strong> j√° teve processos indeferidos anteriormente. Recomendamos que voc√™ consulte os editais para mais informa√ß√µes sobre os crit√©rios de avalia√ß√£o. Ressaltamos que indeferimentos anteriores, n√£o impedem a realiza√ß√£o de novas solicita√ß√µes da mesma institui√ß√£o estrangeira.
                            </div>
                            <div class="button-group">
                                <button class="btn btn-warning" onclick="continueDirectly()">Continuar Mesmo Assim</button>
                                <button class="btn btn-info" onclick="restartChat()">Nova Consulta</button>
                            </div>
                        </div>
                    `;
                    chatArea.appendChild(warningMessage);
                    chatArea.scrollTop = chatArea.scrollHeight;
                } else {
                    currentStep = 4;
                    showStep('step4');
                    loadDocuments();
                }
            }
        }

        function handleInstitutionNotFound() {
            currentStep = 4;
            showStep('step4');
            loadDocuments();
        }

        function continueDirectly() {
            // Cria a pergunta de documentos dinamicamente no final do chat
            const chatArea = document.getElementById('chatArea');
            const documentsMessage = document.createElement('div');
            documentsMessage.classList.add('message');
            documentsMessage.innerHTML = `
                <div class="avatar">ü§ñ</div>
                <div class="message-content">
                    Agora vamos verificar sua documenta√ß√£o. Marque os documentos que voc√™ j√° possui:
                    <div class="info-box">
                        <span class="info-icon">‚ÑπÔ∏è</span>
                        <span class="info-text">Todos os documentos s√£o importantes, mas voc√™ pode prosseguir mesmo que n√£o tenha todos ainda. Esta √© apenas uma verifica√ß√£o para te orientar.</span>
                    </div>
                    <div class="document-list" id="documentListDynamic">
                        <!-- Documents will be loaded here by JavaScript -->
                    </div>
                    <div class="document-counter" id="documentCounterDynamic">0 de 16 documentos marcados</div>
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="handleDocumentCheckDynamic()">Continuar</button>
                    </div>
                </div>
            `;
            
            chatArea.appendChild(documentsMessage);
            loadDocumentsDynamic();
            chatArea.scrollTop = chatArea.scrollHeight;
            currentStep = 4;
        }

        function loadDocumentsDynamic() {
            const documentListDiv = document.getElementById('documentListDynamic');
            documentListDiv.innerHTML = '';
            documents.forEach((doc, index) => {
                const item = document.createElement('div');
                item.classList.add('document-item');
                item.innerHTML = `
                    <input type="checkbox" id="docDynamic${index}" class="document-checkbox" onchange="updateDocumentCounterDynamic()">
                    <label for="docDynamic${index}" class="document-text">${doc.text}</label>
                `;
                documentListDiv.appendChild(item);
            });
            updateDocumentCounterDynamic();
        }

        function updateDocumentCounterDynamic() {
            const checkboxes = document.querySelectorAll('#documentListDynamic .document-checkbox');
            let checkedCount = 0;

            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    checkedCount++;
                }
            });

            const counter = document.getElementById('documentCounterDynamic');
            if (counter) {
                counter.innerText = `${checkedCount} de ${documents.length} documentos marcados`;
            }
        }

        function handleDocumentCheckDynamic() {
            // Cria a pergunta sobre apostilamento dinamicamente
            const chatArea = document.getElementById('chatArea');
            const apostilleMessage = document.createElement('div');
            apostilleMessage.classList.add('message');
            apostilleMessage.innerHTML = `
                <div class="avatar">ü§ñ</div>
                <div class="message-content">
                    √ìtimo! Lembramos que para sua solicita√ß√£o ser analisada √© necess√°rio possuir todos os documentos obrigat√≥rios. Agora preciso saber: seus documentos est√£o apostilados conforme a Conven√ß√£o de Haia?
                    <div class="warning-box">
                        <span class="warning-icon">‚ö†Ô∏è</span>
                        <span class="warning-text">Aten√ß√£o: Os documentos que OBRIGATORIAMENTE precisam estar apostilados s√£o: ATA de defesa, Hist√≥rico Escolar e Diploma.</span>
                    </div>
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="handleApostilleDynamic('yes')">Sim</button>
                        <button class="btn btn-secondary" onclick="handleApostilleDynamic('no')">N√£o</button>
                    </div>
                </div>
            `;
            
            chatArea.appendChild(apostilleMessage);
            chatArea.scrollTop = chatArea.scrollHeight;
            currentStep = 5;
        }

        function handleApostilleDynamic(response) {
            const chatArea = document.getElementById('chatArea');
            let finalMessage;
            
            if (response === 'yes') {
                finalMessage = document.createElement('div');
                finalMessage.classList.add('message');
                finalMessage.innerHTML = `
                    <div class="avatar">üéâ</div>
                    <div class="message-content success-message">
                        <div class="success-icon">‚úÖ</div>
                        <div class="success-title">Parab√©ns! Voc√™ est√° pronto para iniciar seu processo!</div>
                        <div class="success-text">
                            Com base nas suas respostas, voc√™ atende aos requisitos iniciais para o reconhecimento de diploma na UFSM.
                            Voc√™ pode iniciar seu processo na Plataforma Carolina Bori e consultar os editais para mais informa√ß√µes.
                        </div>
                        <a href="https://carolinabori.mec.gov.br/" target="_blank" class="link-button">Acessar Plataforma Carolina Bori</a>
                        <a href="https://www.ufsm.br/pro-reitorias/prpgp/reconhecimento-de-diplomas" target="_blank" class="link-button">Acessar Editais UFSM</a>
                        <div class="button-group">
                            <button class="btn btn-info" onclick="restartChat()">Nova Consulta</button>
                        </div>
                    </div>
                `;
            } else {
                finalMessage = document.createElement('div');
                finalMessage.classList.add('message');
                finalMessage.innerHTML = `
                    <div class="avatar">‚ö†Ô∏è</div>
                    <div class="message-content error-message">
                        <div class="error-icon">‚ö†Ô∏è</div>
                        <div class="error-title">Documentos n√£o apostilados</div>
                        <div class="error-text">
                            Para prosseguir com o reconhecimento de diploma, seus documentos (ATA, Hist√≥rico e Diploma) devem estar apostilados conforme a Conven√ß√£o de Haia.
                            Por favor, providencie o apostilamento e tente novamente.
                        </div>
                        <div class="button-group">
                            <button class="btn btn-info" onclick="restartChat()">Nova Consulta</button>
                        </div>
                    </div>
                `;
            }
            
            chatArea.appendChild(finalMessage);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function loadDocuments() {
            const documentListDiv = document.getElementById('documentList');
            documentListDiv.innerHTML = '';
            documents.forEach((doc, index) => {
                const item = document.createElement('div');
                item.classList.add('document-item');
                item.innerHTML = `
                    <input type="checkbox" id="doc${index}" class="document-checkbox" onchange="updateDocumentCounter()">
                    <label for="doc${index}" class="document-text">${doc.text}</label>
                `;
                documentListDiv.appendChild(item);
            });
            updateDocumentCounter();
        }

        function updateDocumentCounter() {
            const checkboxes = document.querySelectorAll('.document-checkbox');
            let checkedCount = 0;

            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    checkedCount++;
                }
            });

            document.getElementById('documentCounter').innerText = `${checkedCount} de ${documents.length} documentos marcados`;
        }

        function handleDocumentCheck() {
            currentStep = 5;
            showStep('step5');
        }

        function handleApostille(response) {
            if (response === 'yes') {
                showStep('finalSuccess');
            } else {
                showStep('finalNoApostille');
            }
        }

        function restartChat() {
            // Esconde todas as mensagens exceto a inicial
            const allMessages = document.querySelectorAll('.message');
            allMessages.forEach(msg => {
                if (msg.id !== 'step0') {
                    msg.classList.add('hidden');
                }
            });
            
            currentStep = 0;
            selectedInstitution = null;
            document.getElementById('institutionSearch').value = '';
            document.getElementById('selectInstitutionBtn').disabled = true;
            
            // Limpa checkboxes
            const checkboxes = document.querySelectorAll('.document-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            
            updateProgressBar();
        }

        // Inicializa a lista de institui√ß√µes quando a p√°gina carrega
        document.addEventListener('DOMContentLoaded', function() {
            loadInstitutions();
        });
    </script>
</body>
</html>

